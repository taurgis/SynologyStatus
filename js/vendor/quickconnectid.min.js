var QuickConnect=function(l){function m(c,b){for(var a=0;a<e.length;a++){var d=e[a];d.onload=function(){if(this.readyState===XMLHttpRequest.DONE&&200===this.status&&JSON.parse(this.responseText).success){for(var a=0;a<e.length;a++){var b=e[a];b!==this&&b.abort()}c("https://"+this.ip+":"+this.port)}};d.send(null)}}function n(c){var b=[{version:1,command:"get_server_info",stop_when_error:"false",stop_when_success:"false",id:"dsm_portal_https",serverID:f},{version:1,command:"get_server_info",stop_when_error:"false",
stop_when_success:"false",id:"dsm_portal",serverID:f}],a=new XMLHttpRequest;a.open("POST","https://synologyquickconnectid.herokuapp.com/server.php",!0);a.onload=function(){if(a.readyState===XMLHttpRequest.DONE&&200===a.status){var b=JSON.parse(a.responseText);c(b)}};a.send(JSON.stringify(b));return a}function p(c,b){if(c.env.control_host){var a={command:"request_tunnel",version:1,serverID:f,id:"dsm_portal_https"},d=new XMLHttpRequest;d.open("POST","https://synologyquickconnectid.herokuapp.com/server.php?host="+
c.env.control_host,!0);d.onload=function(){if(d.readyState===XMLHttpRequest.DONE&&200===d.status){var a=JSON.parse(d.responseText);b(a)}else b()};d.send(JSON.stringify(a))}else b()}function k(c){var b=c.service.relay_ip,a=c.service.relay_port;c=c.env.relay_region;b&&(b=h(b,a),e.push(b));c&&(b=h(f+"."+c+".quickconnect.to"),e.push(b))}function q(c){var b=c.service.port;if(c.server["interface"])for(var a=0;a<c.server["interface"].length;a++){var d=c.server["interface"][a];if(d.ip){var g=h(d.ip,b);e.push(g)}if(d.ipv6&&
0<d.ipv6.length)for(g=0;g<d.ipv6.length;g++){var f=h("["+d.ipv6[a].address+"]",b);e.push(f)}}}function h(c,b){var a=new XMLHttpRequest;a.ip=c;a.port=b;a.open("GET","https://"+c+(b?":"+b:"")+"/webman/pingpong.cgi?action=cors",!0);return a}var f=l,e=[];return{determineServerURL:function(c,b){n(function(a){a[0].server&&a[0].service?p(a[0],function(d){d&&k(d);q(a[0]);k(a[0]);m(function(a){c&&c(a)},function(a){b&&b(a)})}):b&&b("No server found")})}}};
